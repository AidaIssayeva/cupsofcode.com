<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Integrating a seamless in-app review rating experience in MVI - Cups of Code</title><link rel=apple-touch-icon href=https://cupsofcode.com/images/favicons/logo.svg sizes=180x180><link rel=icon href=https://cupsofcode.com/images/favicons/logo.svg sizes=32x32 type=image/png><link rel=icon href=https://cupsofcode.com/images/favicons/logo.svg sizes=16x16 type=image/png><link rel=manifest href=https://cupsofcode.com/images/favicons/manifest.json><link rel=icon href=https://cupsofcode.com/images/favicons/logo.svg><meta name=keywords content><meta name=description content="Tutorial of implementing a new In-App Review API, including star ratings and reviews, by Google Play Core in MVI android app development architecture"><meta itemprop=name content="Integrating a seamless in-app review rating experience in MVI"><meta itemprop=description content="Tutorial of implementing a new In-App Review API, including star ratings and reviews, by Google Play Core in MVI android app development architecture"><meta itemprop=datePublished content="2021-10-30T00:00:00+00:00"><meta itemprop=dateModified content="2021-10-30T00:00:00+00:00"><meta itemprop=wordCount content="1056"><meta itemprop=image content="https://cupsofcode.com/images/in_app_review_API_integration_android_mvi.jpg"><meta itemprop=keywords content="android,"><meta property="og:title" content="Integrating a seamless in-app review rating experience in MVI"><meta property="og:description" content="Tutorial of implementing a new In-App Review API, including star ratings and reviews, by Google Play Core in MVI android app development architecture"><meta property="og:type" content="article"><meta property="og:url" content="https://cupsofcode.com/post/google_play_in-app_review_api_integration_mvi/"><meta property="og:image" content="https://cupsofcode.com/images/in_app_review_API_integration_android_mvi.jpg"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-10-30T00:00:00+00:00"><meta property="article:modified_time" content="2021-10-30T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cupsofcode.com/images/in_app_review_API_integration_android_mvi.jpg"><meta name=twitter:title content="Integrating a seamless in-app review rating experience in MVI"><meta name=twitter:description content="Tutorial of implementing a new In-App Review API, including star ratings and reviews, by Google Play Core in MVI android app development architecture"><meta name=twitter:site content="@aida_isay"><meta data-name=palette content="brown"><link rel=stylesheet href=https://cupsofcode.com/css/bundle.min.c0634b2209dea5d6876106ad4156af8b48c56f092d70c73a0a5900e0c754e686.css integrity="sha256-wGNLIgnepdaHYQatQVavi0jFbwktcMc6ClkA4MdU5oY=" crossorigin=anonymous><script src=https://cupsofcode.com/js/bundle.min.49b5b199db6f7ed9a80462dc05d2fa95d1779547094d452354baa7665152764b.js integrity="sha256-SbWxmdtvftmoBGLcBdL6ldF3lUcJTUUjVLqnZlFSdks=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-154896629-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=mode-light><header><nav class="navbar navbar-expand-xl fixed-top"><div class=container><a href=https://cupsofcode.com/><img alt=Logo src=https://cupsofcode.com/images/cupsOfCode_banner_dark_text.png loading=lazy style=margin-left:.8rem;height:4rem;margin-top:-10px;margin-bottom:-8px;margin-right:10px></a>
<button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav me-1 mb-2 mb-lg-0"><form class="search-bar d-flex ms-1" action=https://cupsofcode.com/search><div class="input-group input-group-sm"><button class="btn btn-search disabled position-absolute left-0" type=submit><i class="fas fa-fw fa-search"></i></button>
<input class="form-control rounded-pill" id=searchQuery name=q type=search aria-label=Search></div></form></ul><ul class="navbar-nav me-1 mb-2 mb-lg-0 me-1 ms-auto"><li class=nav-item><a class=nav-link href=https://cupsofcode.com/about>About</a></li><li class=nav-item><a class=nav-link href=https://cupsofcode.com/tools>Tools</a></li><li class=nav-item><a class=nav-link href=https://imp.i115008.net/jWQXNb target=_blank>Courses</a></li><li class=nav-item><a class=nav-link href=https://cupsofcode.com/talks>Talks</a></li><li class=nav-item><a class=nav-link href=https://www.theorganizeddev.com/ target=_blank>Templates</a></li><li class=nav-item><a class=nav-link href=https://cupsofcode.com/archives>Archives</a></li></ul></div></div></nav></header><main role=main class=container><div class="row content"><div class=col-lg-8><div class=container><nav class=row aria-label=breadcrumb><ol class="breadcrumb surface"><li class=breadcrumb-item><a href=https://cupsofcode.com/>Home</a></li><li class=breadcrumb-item><a href=https://cupsofcode.com/post/>Posts</a></li><li class="breadcrumb-item active">Integrating a Seamless In-App Review Rating Experience in MVI</li></ol></nav><article class="post row surface"><div class=post-panel-wrapper><div class="post-panel d-flex flex-column"><a class=action data-bs-container=body data-bs-toggle=popover data-bs-html=true data-bs-placement=bottom data-bs-trigger=focus tabindex=0 data-bs-content='<a target="_blank" rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.en">CC BY-NC-ND 4.0 <i class="fab fa-fw fa-creative-commons"></i><i class="fab fa-fw fa-creative-commons-by"></i><i class="fab fa-fw fa-creative-commons-nc"></i><i class="fab fa-fw fa-creative-commons-nd"></i></a>
'><i class="fas fa-fw fa-copyright"></i></a></div></div><h1 class="post-title my-3">Integrating a Seamless In-App Review Rating Experience in MVI</h1><div class="post-meta mb-3" style=word-break:break-word><span class="post-date me-2"><i class="fas fa-fw fa-calendar-alt"></i>Oct 30, 2021</span>
<span class="post-reading-time me-2"><i class="fas fa-fw fa-coffee"></i>5 min read
</span><a href=https://cupsofcode.com/categories/android-development/ class=post-button-tag>Android Development</a><a href=https://cupsofcode.com/tags/android/ class=post-button-tag>android</a></div><div class="post-share mb-3"></div><div class="offcanvas offcanvas-end surface" tabindex=-1 id=offcanvasTOC aria-labelledby=offcanvasTOCLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasTOCLabel>Table Of Contents</h5><a role=button data-bs-dismiss=offcanvas aria-label=Close><span class="fas fa-2x fa-fw fa-times"></span></a></div><div class=offcanvas-body><nav id=TableOfContents><ul><li><a href=#implementation>Implementation</a></li><li><a href=#testing>Testing</a><ul><li><a href=#manual-testing>Manual Testing</a></li><li><a href=#unit-testing>Unit Testing</a></li></ul></li></ul></nav></div></div><div class=imageArt style=max-width:100%><img style=max-width:100%;object-fit:contain src=https://cupsofcode.com/images/in_app_review_API_integration_android_mvi.jpg></div><a></br></a><div class="post-content mb-3"><div><h4 style=margin-bottom:10px>Table Of Contents:</h4><nav id=TableOfContents><ul><li><a href=#implementation>Implementation</a></li><li><a href=#testing>Testing</a><ul><li><a href=#manual-testing>Manual Testing</a></li><li><a href=#unit-testing>Unit Testing</a></li></ul></li></ul></nav></div><p>Last year, Android introduced a new in-app review API that would allow users to review and rate an app within the app itself. Meaning, developers no longer have to worry about keeping track of how many times the “Rate Us” dialog has been displayed to users and whether the users clicked to go Play Store App.</p><p>The intention of this API is to remove overhead on developers and keep users <strong>in the app with respect to their privacy</strong>. However, from a developer standpoint, there are a couple of prerequisites to keep in mind while integrating the in-app review API.</p><ol><li><p>Your app’s <code>applicationId</code> must at least be available in the internal track on Google Play, otherwise the in-app review will never appear.</p></li><li><p>Displaying a review bottomsheet is not guaranteed. Play Core handles the logic of how many times the bottomsheet will be displayed to a user, whether the user has interacted with the bottomsheet, and whether the user has already submitted a review. The API only exposes one listener to notify whether we should proceed with the regular flow in the app. Thus, all this handling done by the API causes end-to-end testing to become difficult.</p></li></ol><p>In this tutorial, I’ll walk you through the integration of the in-app review API in MVI fashion.</p><h3 id=implementation>Implementation</h3><p>Prerequisites of this tutorial:</p><ul><li>RxJava</li><li>Dagger</li><li>MVI (model-view-intent)</li></ul><p>Let’s dive into details:</p><p><strong>Step 1:</strong></p><p>Add the following dependencies into the <code>build.gradle</code> file of your desired feature:</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=ln>1</span><span class=c1>// This dependency is downloaded from Google’s Maven repository.
</span><span class=ln>2</span><span class=c1>// So, make sure you also include that repository in your project&#39;s build.gradle file.
</span><span class=ln>3</span><span class=c1></span><span class=n>implementation</span> <span class=err>&#39;</span><span class=n>com</span><span class=p>.</span><span class=n>google</span><span class=p>.</span><span class=n>android</span><span class=p>.</span><span class=n>play</span><span class=p>:</span><span class=n>core</span><span class=p>:</span><span class=m>1.10</span><span class=p>.</span><span class=m>2</span><span class=err>&#39;</span>
<span class=ln>4</span>
<span class=ln>5</span><span class=c1>// For Kotlin users also import the Kotlin extensions library for Play Core:
</span><span class=ln>6</span><span class=c1></span><span class=n>implementation</span> <span class=err>&#39;</span><span class=n>com</span><span class=p>.</span><span class=n>google</span><span class=p>.</span><span class=n>android</span><span class=p>.</span><span class=n>play</span><span class=p>:</span><span class=n>core</span><span class=p>-</span><span class=n>ktx</span><span class=p>:</span><span class=m>1.8</span><span class=p>.</span><span class=m>1</span><span class=err>&#39;</span></code></pre></div><p><strong>Step 2:</strong></p><p>Create an instance of <code>ReviewManager</code> inside the desired feature’s dagger module:</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=ln>1</span><span class=nd>@Provides</span>
<span class=ln>2</span><span class=nd>@Singleton</span>
<span class=ln>3</span><span class=k>fun</span> <span class=nf>providesReviewManager</span><span class=p>():</span> <span class=n>ReviewManager</span> <span class=p>{</span>
<span class=ln>4</span>   <span class=k>return</span> <span class=n>ReviewManagerFactory</span><span class=p>.</span><span class=n>create</span><span class=p>(</span><span class=n>context</span><span class=p>)</span>
<span class=ln>5</span><span class=p>}</span></code></pre></div><p><strong>Step 3:</strong></p><p>Inject the instance into the feature’s viewmodel:<div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=ln>1</span><span class=k>class</span> <span class=nc>ActivityViewModel</span> <span class=nd>@Inject</span> <span class=k>constructor</span><span class=p>(</span>
<span class=ln>2</span>   <span class=k>private</span> <span class=k>val</span> <span class=py>navigator</span><span class=p>:</span> <span class=n>Navigator</span><span class=p>,</span>
<span class=ln>3</span>   <span class=k>private</span> <span class=k>val</span> <span class=py>reviewManager</span><span class=p>:</span> <span class=n>ReviewManager</span>
<span class=ln>4</span><span class=p>)</span> <span class=p>:</span> <span class=n>ViewModel</span><span class=p>()</span> <span class=p>{</span></code></pre></div></p><p><strong>Step 4:</strong></p><p>In this step we introduce the logic of triggering the in-app review. Due to the quota limitations, Play Console advises not to have any call-to-action option that triggers the API. So the best way to trigger it will be after completing a couple of levels in a game, and/or after the user becomes familiar with the app and has used it for quite a while.</p><p>In my example, I don’t have too much complicated logic implemented. Rather, I&rsquo;m just triggering the API after the 5th,10th, and 20th session. Session numbers are saved in shared preferences.</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=ln> 1</span><span class=n>Single</span><span class=p>.</span><span class=n>create</span><span class=p>&lt;</span><span class=n>ReviewInfo</span><span class=p>&gt;</span> <span class=p>{</span> <span class=n>emitter</span> <span class=o>-&gt;</span>
<span class=ln> 2</span>   <span class=k>val</span> <span class=py>session</span> <span class=p>=</span> <span class=n>sharedPreferences</span><span class=p>.</span><span class=n>getInt</span><span class=p>(</span><span class=n>SESSION</span><span class=p>,</span> <span class=m>1</span><span class=p>)</span>
<span class=ln> 3</span>   <span class=k>if</span> <span class=p>(</span><span class=n>session</span> <span class=o>==</span> <span class=m>5</span> <span class=o>||</span> <span class=n>session</span> <span class=o>==</span> <span class=m>10</span> <span class=o>||</span> <span class=n>session</span> <span class=o>==</span> <span class=m>20</span><span class=p>)</span> <span class=p>{</span>
<span class=ln> 4</span>       <span class=k>val</span> <span class=py>reviewInfo</span> <span class=p>=</span> <span class=n>reviewManager</span><span class=p>.</span><span class=n>requestReviewFlow</span><span class=p>()</span>
<span class=ln> 5</span>       <span class=n>reviewInfo</span><span class=p>.</span><span class=n>addOnCompleteListener</span> <span class=p>{</span> <span class=n>task</span> <span class=o>-&gt;</span>
<span class=ln> 6</span>           <span class=k>if</span> <span class=p>(</span><span class=n>task</span><span class=p>.</span><span class=n>isSuccessful</span><span class=p>)</span> <span class=p>{</span>
<span class=ln> 7</span>               <span class=n>emitter</span><span class=p>.</span><span class=n>onSuccess</span><span class=p>(</span><span class=n>task</span><span class=p>.</span><span class=n>result</span><span class=p>)</span>
<span class=ln> 8</span>           <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
<span class=ln> 9</span>               <span class=n>emitter</span><span class=p>.</span><span class=n>onError</span><span class=p>(</span><span class=n>Throwable</span><span class=p>(</span><span class=n>task</span><span class=p>.</span><span class=n>exception</span><span class=p>))</span>
<span class=ln>10</span>           <span class=p>}</span>
<span class=ln>11</span>
<span class=ln>12</span>       <span class=p>}</span>
<span class=ln>13</span>   <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
<span class=ln>14</span>       <span class=n>emitter</span><span class=p>.</span><span class=n>onError</span><span class=p>(</span><span class=n>Throwable</span><span class=p>(</span><span class=s2>&#34;no time to request in-app review&#34;</span><span class=p>))</span>
<span class=ln>15</span>   <span class=p>}</span>
<span class=ln>16</span><span class=p>}.</span><span class=n>map</span><span class=p>&lt;</span><span class=n>ActivityIntent</span><span class=p>&gt;</span> <span class=p>{</span>
<span class=ln>17</span>   <span class=n>ActivityIntent</span><span class=p>.</span><span class=n>InAppReviewRequested</span><span class=p>(</span><span class=k>it</span><span class=p>)</span>
<span class=ln>18</span><span class=p>}.</span><span class=n>onErrorReturn</span> <span class=p>{</span> <span class=n>error</span> <span class=o>-&gt;</span>
<span class=ln>19</span>   <span class=c1>//If this throws an error, do you need to display it to a user? Not really.
</span><span class=ln>20</span><span class=c1></span>   <span class=c1>// We can just log an error.
</span><span class=ln>21</span><span class=c1></span>   <span class=n>ActivityIntent</span><span class=p>.</span><span class=n>NoOp</span>
<span class=ln>22</span><span class=p>}.</span><span class=n>toObservable</span><span class=p>()</span></code></pre></div><p>If the session is 5th, 10th or 20th, <strong>request</strong> a review flow from ReviewManager (line 4).
Add a complete listener to the request. If the request is successful, we can go ahead and <strong>launch</strong> the review flow on UI. If not, we emit the error, but do nothing with it (when mapping, the error is converted into <code>NoOp</code> intent that doesn’t change or update the viewstate).</p><p><strong>Step 5:</strong></p><p>In the reducer, pass the reviewInfo object which is used to launch the flow, to the state:</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=ln>1</span><span class=k>is</span> <span class=n>ActivityIntent</span><span class=p>.</span><span class=n>InAppReviewRequested</span> <span class=o>-&gt;</span> <span class=p>{</span>
<span class=ln>2</span>   <span class=n>previous</span><span class=p>.</span><span class=n>copy</span><span class=p>(</span><span class=n>reviewInfo</span> <span class=p>=</span> <span class=n>intent</span><span class=p>.</span><span class=n>reviewInfo</span><span class=p>)</span>
<span class=ln>3</span><span class=p>}</span></code></pre></div><p><strong>Step 6:</strong>
In the subscriber, listen to the changes and if reviewInfo object exists inside the viewstate, launch the flow:</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=ln>1</span><span class=n>viewState</span><span class=p>.</span><span class=n>reviewInfo</span><span class=o>?.</span><span class=n>run</span> <span class=p>{</span>
<span class=ln>2</span>   <span class=k>val</span> <span class=py>review</span> <span class=p>=</span> <span class=n>reviewManager</span><span class=p>.</span><span class=n>launchReviewFlow</span><span class=p>(</span><span class=k>this</span><span class=nd>@MainActivity</span><span class=p>,</span> <span class=k>this</span><span class=p>)</span>
<span class=ln>3</span>   <span class=n>review</span><span class=p>.</span><span class=n>addOnCompleteListener</span> <span class=p>{</span>
<span class=ln>4</span>       <span class=n>intentsSubject</span><span class=p>.</span><span class=n>onNext</span><span class=p>(</span><span class=n>ActivityIntent</span><span class=p>.</span><span class=n>InAppReviewCompleted</span><span class=p>)</span>
<span class=ln>5</span>   <span class=p>}</span>
<span class=ln>6</span><span class=p>}</span></code></pre></div><p>After the review flow is completed(note: even at this point, it is not guaranteed whether the bottomsheet will appear or not), trigger the <code>InAppReviewCompleted</code> intent to continue on with the regular flow.
In our viewmodel, where intents are bounded, handle the <code>InAppReviewCompleted</code> :</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=ln>1</span><span class=k>it</span><span class=p>.</span><span class=n>ofType</span><span class=p>(</span><span class=n>ActivityIntent</span><span class=p>.</span><span class=n>InAppReviewCompleted</span><span class=o>::</span><span class=k>class</span><span class=p>.</span><span class=n>java</span><span class=p>)</span>
<span class=ln>2</span>   <span class=p>.</span><span class=n>flatMapCompletable</span> <span class=p>{</span>
<span class=ln>3</span>       <span class=c1>//after receiving a signal that review flow ended, we proceed with regular flow
</span><span class=ln>4</span><span class=c1></span>       <span class=n>navigator</span><span class=p>.</span><span class=n>navigateTo</span><span class=p>(</span><span class=n>NavigatorPath</span><span class=p>.</span><span class=n>Feed</span><span class=p>)</span>
<span class=ln>5</span>   <span class=p>}.</span><span class=n>toObservable</span><span class=p>&lt;</span><span class=n>ActivityIntent</span><span class=p>&gt;()</span></code></pre></div><h3 id=testing>Testing</h3><h4 id=manual-testing>Manual Testing</h4><p>For manual testing, make sure an account has not reviewed the app yet. If so - delete the review and add the account email into the internal test tracking group. Then, proceed to distribute the internal test build to your test group.
There is a great <a href=https://johncodeos.com/how-to-integrate-in-app-reviews-in-android-using-kotlin/ target=_blank>walkthrough</a>
of in-app review manual testing by John Codeos.</p><h4 id=unit-testing>Unit Testing</h4><p>I’ve noticed in many blog posts about in-app review API, the unit testing is not fully covered and only briefly mentioned. It will not be the case with this post 😉.</p><p>For mocking in unit tests, I use <a href=https://mockk.io/ target=_blank>Mockk</a>
library.<div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=ln>1</span><span class=n>implementation</span> <span class=err>&#39;</span><span class=n>io</span><span class=p>.</span><span class=n>mockk</span><span class=p>:</span><span class=n>mockk</span><span class=p>:</span><span class=m>1.10</span><span class=p>.</span><span class=m>2</span><span class=err>&#39;</span></code></pre></div></p><p>Inside the ViewModelTest, create a mock instance of <code>FakeReviewManager</code>:</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=ln>1</span><span class=k>private</span> <span class=k>val</span> <span class=py>reviewManager</span><span class=p>:</span> <span class=n>FakeReviewManager</span> <span class=p>=</span> <span class=n>mockk</span><span class=p>(</span><span class=n>relaxed</span> <span class=p>=</span> <span class=k>true</span><span class=p>)</span></code></pre></div><p>Then mock the instance of the task and reviewInfo:<div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=ln>1</span><span class=k>val</span> <span class=py>mockReviewInfo</span> <span class=p>=</span> <span class=n>mockk</span><span class=p>&lt;</span><span class=n>ReviewInfo</span><span class=p>&gt;(</span><span class=n>relaxed</span> <span class=p>=</span> <span class=k>true</span><span class=p>)</span>
<span class=ln>2</span><span class=k>val</span> <span class=py>mockReviewInstance</span> <span class=p>=</span> <span class=n>mockk</span><span class=p>&lt;</span><span class=n>Task</span><span class=p>&lt;</span><span class=n>ReviewInfo</span><span class=p>&gt;&gt;(</span><span class=n>relaxed</span> <span class=p>=</span> <span class=k>true</span><span class=p>)</span></code></pre></div></p><p>Then mock the <em>successful</em> behavior of reviewInfo and task instances:</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=ln> 1</span><span class=c1>//given
</span><span class=ln> 2</span><span class=c1></span><span class=n>every</span> <span class=p>{</span> <span class=n>mockReviewInstance</span><span class=p>.</span><span class=n>isSuccessful</span> <span class=p>}</span> <span class=n>returns</span> <span class=k>true</span>
<span class=ln> 3</span><span class=n>every</span> <span class=p>{</span> <span class=n>mockReviewInstance</span><span class=p>.</span><span class=n>result</span> <span class=p>}</span> <span class=n>returns</span> <span class=n>mockReviewInfo</span>
<span class=ln> 4</span><span class=n>every</span> <span class=p>{</span> <span class=n>reviewManager</span><span class=p>.</span><span class=n>requestReviewFlow</span><span class=p>()</span> <span class=p>}</span> <span class=n>returns</span> <span class=n>mockReviewInstance</span>
<span class=ln> 5</span>
<span class=ln> 6</span><span class=k>val</span> <span class=py>slot</span> <span class=p>=</span> <span class=n>slot</span><span class=p>&lt;</span><span class=n>OnCompleteListener</span><span class=p>&lt;</span><span class=n>ReviewInfo</span><span class=p>&gt;&gt;()</span>
<span class=ln> 7</span><span class=n>every</span> <span class=p>{</span> <span class=n>mockReviewInstance</span><span class=p>.</span><span class=n>addOnCompleteListener</span><span class=p>(</span><span class=n>capture</span><span class=p>(</span><span class=n>slot</span><span class=p>))</span> <span class=p>}</span> <span class=n>answers</span> <span class=p>{</span>
<span class=ln> 8</span>   <span class=n>slot</span><span class=p>.</span><span class=n>captured</span><span class=p>.</span><span class=n>onComplete</span><span class=p>(</span><span class=n>mockReviewInstance</span><span class=p>)</span>
<span class=ln> 9</span>   <span class=n>mockReviewInstance</span>
<span class=ln>10</span><span class=p>}</span></code></pre></div><p>Set up a list of expected viewstates:<div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=ln>1</span><span class=c1>//given
</span><span class=ln>2</span><span class=c1></span><span class=k>val</span> <span class=py>expectedViewStates</span> <span class=p>=</span> <span class=n>arrayOf</span><span class=p>(</span>
<span class=ln>3</span>   <span class=n>ViewState</span><span class=p>(),</span>
<span class=ln>4</span>   <span class=n>ViewState</span><span class=p>().</span><span class=n>copy</span><span class=p>(</span><span class=n>reviewInfo</span> <span class=p>=</span> <span class=n>mockReviewInfo</span><span class=p>)</span>
<span class=ln>5</span><span class=p>)</span></code></pre></div></p><p>Then check values of actual and expected view states:<div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=ln>1</span><span class=c1>//when
</span><span class=ln>2</span><span class=c1></span><span class=k>val</span> <span class=py>resultsObserver</span> <span class=p>=</span> <span class=n>activityViewModel</span><span class=p>.</span><span class=n>bind</span><span class=p>(</span><span class=n>intentSubject</span><span class=p>).</span><span class=n>test</span><span class=p>()</span>
<span class=ln>3</span>
<span class=ln>4</span><span class=c1>//then
</span><span class=ln>5</span><span class=c1></span><span class=n>resultsObserver</span><span class=p>.</span><span class=n>assertValues</span><span class=p>(*</span><span class=n>expectedViewStates</span><span class=p>)</span></code></pre></div></p><p>For <em>failed</em> state, mock the failed behavior by tweaking the return:</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=ln>1</span><span class=c1>//given
</span><span class=ln>2</span><span class=c1></span><span class=n>every</span> <span class=p>{</span> <span class=n>mockReviewInstance</span><span class=p>.</span><span class=n>isSuccessful</span> <span class=p>}</span> <span class=n>returns</span> <span class=k>false</span>
<span class=ln>3</span><span class=n>every</span> <span class=p>{</span> <span class=n>mockReviewInstance</span><span class=p>.</span><span class=n>result</span> <span class=p>}</span> <span class=n>returns</span> <span class=n>mockReviewInfo</span>
<span class=ln>4</span><span class=n>every</span> <span class=p>{</span> <span class=n>mockReviewInstance</span><span class=p>.</span><span class=n>exception</span> <span class=p>}</span> <span class=n>returns</span> <span class=n>Exception</span><span class=p>(</span><span class=n>Unsuccessful_Task</span><span class=p>)</span>
<span class=ln>5</span><span class=n>every</span> <span class=p>{</span> <span class=n>reviewManager</span><span class=p>.</span><span class=n>requestReviewFlow</span><span class=p>()</span> <span class=p>}</span> <span class=n>returns</span> <span class=n>mockReviewInstance</span></code></pre></div><div class="alert alert-success" role=alert><i class="fas fa-fw fa-check-circle"></i>Protip: the same style of detailed mocking Task and Object can be applied with other Google products like Firebase, Play Core, etc.
<a href target=_blank></a></div><p>The full integration PR can be found <a href=https://github.com/AidaIssayeva/Android-Clean-Modular-and-MVI/pull/2 target=_blank>here</a>
with unit tests in place.</p><p>I hope this post was helpful. If you have questions or something is unclear - please leave a comment!</p><hr><p>Huge thank you to <a href=https://www.linkedin.com/in/eugeniolopez1/ target=_blank>Eugenio Lopez</a>
for reviewing and editing this blog post 🙏.</p></div><hr><div class=post_buycoffee><p><b>❤️ Was this post helpful?</b></p><p>If you liked the article, give a shoutout to @aida_isay on
<a target=_blank href=https://www.instagram.com/aida_isay/><b>Instagram</b></a>, <a target=_blank href=https://www.threads.net/@aida_isay><b>Threads</b></a>,
or <a target=_blank href=https://twitter.com/Aida_Isay><b>Twitter</b></a>
and help share this article.</p><p>Thank you for your support 🙌</p></div><div style=margin-top:5px;margin-bottom:5px><a href="https://imp.i115008.net/c/2292842/912909/11298?subId1=CupsOfCode" target=_blank id=912909><img src=//a.impactradius-go.com/display-ad/11298-912909 style=max-width:100%></a><img height=0 width=0 src="https://imp.pxf.io/i/2292842/912909/11298?subId1=CupsOfCode" style=position:absolute;visibility:visible border=0></div><div class="post-navs d-flex mb-3 justify-content-between"><div class="post-nav w-50"><div class="prev-post btn btn-sm"><a href=https://cupsofcode.com/post/the_five_step_guide_to_become_android_developer/>The 5-Step Guide to Become an Android Developer</a></div></div><div class="post-nav flex-row-reverse"><div class="next-post btn btn-sm"><a href=https://cupsofcode.com/post/2021_review/>2021 Year in Review</a></div></div></div><section class=related-posts><h3>Related Posts</h3><ul class=related-posts><li><a href=https://cupsofcode.com/post/when_how_use_rxjava_disposable_serialdisposable_compositedisposable/>When and How to Use RxJava Disposable</a></li><li><a href=https://cupsofcode.com/post/how-to-display-notification-in-2020/>How to Display Notifications in 2020</a></li><li><a href=https://cupsofcode.com/post/good-and-sad-extensions/>Good and Sad Examples of Extension Functions</a></li><li><a href=https://cupsofcode.com/post/the_five_step_guide_to_become_android_developer/>The 5-Step Guide to Become an Android Developer</a></li><li><a href=https://cupsofcode.com/post/story_of_upgrading_hugo/>Story of Upgrading Hugo</a></li></ul></section></article><div class="post-comments surface row"><script src=https://utteranc.es/client.js repo=AidaIssayeva/AidaIssayeva.github.io issue-term=pathname label theme=github-light crossorigin=anonymous async></script></div></div></div><aside class="col-lg-4 sidebar d-flex"><div class=container><section class="profile surface row text-center"><div class="col-12 d-flex align-items-center justify-content-center"><img class=profile-avatar src=https://cupsofcode.com/images/profile.jpg alt="Aida Issayeva" loading=lazy></div><div class=col-12><h5 class="profile-name my-2">Aida Issayeva</h5><div class="profile-bio mb-2">Software Engineer | Google Developer Expert in Android. I build and scale world-class mobile apps, and jot some thoughts on software, career, and personal development along the way.</div><div class=profile-meta><span class=profile-location><i class="fas fa-fw fa-map-marker-alt"></i>Jersey City</span><span class=profile-about><i class="fas fa-fw fa-info-circle"></i><a href=https://cupsofcode.com/about/>About Me</a></span></div></div></section><section class="recent-posts row surface"><h4>Recent Posts</h4><ul><li><a href=https://cupsofcode.com/post/day_22_5_small_but_easily_fixable_mistakes_most_software_engineers_do_when_trying_to_get_promoted_part_2/>5 Small (But Easily Fixable) Mistakes Most Software Engineers Do When Trying to Get Promoted - Part 2</a></li><li><a href=https://cupsofcode.com/post/day_21_5_small_but_easily_fixable_mistakes_most_software_engineers_do_when_trying_to_get_promoted_part_1/>5 Small (But Easily Fixable) Mistakes Most Software Engineers Do When Trying to Get Promoted - Part 1</a></li><li><a href=https://cupsofcode.com/post/day_20_4_reasons_why_i_think_everyone_should_read_staff_engineer_leadership_beyond_management_track/>4 Reasons Why I Think Everyone Should Read Staff Engineer: Leadership Beyond Management Track</a></li><li><a href=https://cupsofcode.com/post/day_19_3_simple_but-effective_pieces_of_advice_id_give_anyone_starting_in_software_development/>3 Simple (But Effective) Pieces of Advice I’d Give Anyone Starting in Software Development</a></li><li><a href=https://cupsofcode.com/post/day_18_if_you_re_interested_in_learning_android_development_subscribe_to_this_youtube_channel/>If You’re Interested in Learning Android Development, Subscribe to This YouTube Channel</a></li></ul></section><section class="taxonomy-categories row surface"><h4><a href=https://cupsofcode.com/categories>Categories</a></h4><div><a href=https://cupsofcode.com/categories/ship-30-for-30/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Ship 30 for 30">Ship 30 for 30 <span class="badge rounded-pill">22</span>
</a><a href=https://cupsofcode.com/categories/career/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=Career>Career <span class="badge rounded-pill">11</span>
</a><a href=https://cupsofcode.com/categories/android-development/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Android Development">Android Development <span class="badge rounded-pill">10</span>
</a><a href=https://cupsofcode.com/categories/personal/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=Personal>Personal <span class="badge rounded-pill">8</span>
</a><a href=https://cupsofcode.com/categories/tech-leadership/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Tech Leadership">Tech Leadership <span class="badge rounded-pill">3</span>
</a><a href=https://cupsofcode.com/categories/technical-documentation/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Technical Documentation">Technical Documentation <span class="badge rounded-pill">3</span>
</a><a href=https://cupsofcode.com/categories/web-development/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="Web Development">Web Development <span class="badge rounded-pill">2</span>
</a><a href=https://cupsofcode.com/categories/talks/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=Talks>Talks <span class="badge rounded-pill">1</span></a></div></section><section class="taxonomy-tags row surface"><h4><a href=https://cupsofcode.com/tags>Tags</a></h4><div><a href=https://cupsofcode.com/tags/android/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=android>android <span class="badge rounded-pill">8</span>
</a><a href=https://cupsofcode.com/tags/early-career/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="early career">early career <span class="badge rounded-pill">6</span>
</a><a href=https://cupsofcode.com/tags/jetpack-compose/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="jetpack compose">jetpack compose <span class="badge rounded-pill">3</span>
</a><a href=https://cupsofcode.com/tags/hugo/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=hugo>hugo <span class="badge rounded-pill">2</span>
</a><a href=https://cupsofcode.com/tags/web/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=web>web <span class="badge rounded-pill">2</span>
</a><a href=https://cupsofcode.com/tags/frameworks/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=frameworks>frameworks <span class="badge rounded-pill">1</span>
</a><a href=https://cupsofcode.com/tags/interview-process/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="interview process">interview process <span class="badge rounded-pill">1</span>
</a><a href=https://cupsofcode.com/tags/kotlin/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=kotlin>kotlin <span class="badge rounded-pill">1</span>
</a><a href=https://cupsofcode.com/tags/rx/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title=rx>rx <span class="badge rounded-pill">1</span>
</a><a href=https://cupsofcode.com/tags/software-development/ class="post-taxonomy rounded btn btn-sm me-2 mb-2" title="software development">software development <span class="badge rounded-pill">1</span></a></div></section></div></aside></div></main><footer class="footer mt-auto py-3 text-center container"><nav class="social-links nav my-2 justify-content-center"><li class=nav-item><a class="nav-link social-link" target=_blank href=https://github.com/AidaIssayeva title=GitHub rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-github"></i></a></li><li class=nav-item><a class="nav-link social-link" target=_blank href=https://www.instagram.com/aida_isay title=Instagram rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-instagram"></i></a></li><li class=nav-item><a class="nav-link social-link" target=_blank href=https://linkedin.com/in/aidaisay title=LinkedIn rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-linkedin-in"></i></a></li><li class=nav-item><a class="nav-link social-link" target=_blank href=https://www.tiktok.com/@aida_isay title=Tiktok rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-tiktok"></i></a></li><li class=nav-item><a class="nav-link social-link" target=_blank href=https://twitter.com/aida_isay title=Twitter rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-twitter"></i></a></li><li class=nav-item><a class="nav-link social-link" target=_blank href=https://www.youtube.com/channel/UCirX1GBbjqLkg7c7N-iIqOQ title=Youtube rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-youtube"></i></a></li></nav><div class="copyright mb-2">Copyright © 2024, Cups of Code</div></footer><a id=btnScrollToTop class=btn-scroll-to-top><i class="fas fa fa-chevron-circle-up fa-2x"></i></a></body></html>